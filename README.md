# object-recognizer

## Structure

  * data: data sources to build a model based upon
    * images: image data
      * negative: collections of background images in different size
      * positive: collections of positive images for different objects
  * model: includes trainer and constructed model
    * cascade: cascade classifier trainer and its model
      * cascade_generator: generate cascade
        * bin: buliding a training
        * positive_images: should contain processed positive images
        * tools: include a script to merge vector files
        * negative_images: should contain processed negative images
      * cascade_storage: store cascades generated by cascade_generater
      * cascade_testor: test stored cascades
  * util: generic scripts for other programs
    * bin: conduct all necessary precondition tasks for building training
    * libs: collection of program to conduct individual precondition tasks


## Cascade Classifier Training Process (Commands and Arguments)

1. Get negative sample images and put it in './negative_images' (NOT containing object that you want to recognize)

2. Get source positive sample images and put it in './positive_images' (containing object that you want to recognize)

3. To generate vec files from the samples, run 

      `$ python bin/build_train.py`

4. Conduct cascade training

      `$ opencv_traincascade -data classifier -vec samples.vec -bg negatives.txt -numStages 15 -numPos 2900 -numNeg 1450 -w 20 -h 40 -mode ALL -precalcValBufSize 1024 -precalcIdxBufSize 1024`


## How to train better cascade

  * Preconditioning source images (Cropping and grayscaling):
    * If you want to detect a object with its outline (a shape of cans etc..), you should crop positive images with some extra space around the outline of the object.
    * The size of positive images should be as close as possible but it is not needed to be exactly same.
    * Do not forget grayscale every negative and positive images before proceeding.
    * To generalize, the variety of positive images is important. If you want to find a cans from different angles, you should feed in cans images took from differnt angles.
  * Creating samples:
    * Make sure positive samples generated by running opencv_createsamples is preferable from the perspective of processing machine. It is highly recommended to understand how cascade trainer learns from images by reading technical documents.
    * If you want to detect a target object in bright backgroudn, you may need to configure the -inv (invert the color of sample images) or -randinv (invert the color of sample images in random).
  * Training a cascade:
    * The more samples to feed in the training process brings better result.
    * The good ratio of the positive and negative samples is 2:1.
    * The more buffer size given, the faster the training process becomes.
    * The good acceptance ratio is nearly 10e-5. Beyond that, it's over training and cascade can become too sensitve to particular features of positive samples.



The cascade works well in the dark background for now. May be we should make the cascade background color configuration to be inverted so that the bright color foregorund cans turning to be dark on the bright background.

Building benchmarking tools is in progress of designing.


## Test Cascade

      `$ python testCascadeRealTime.py {cascade object width} {cascade object height} {scale factor} {minimum neighbors} {webcam frame width} {webcam frame height}`

For example,
      
      `$ python testCascadeRealTime.py 20 50 1.1 22 800 600`


## References:

[How to Install OpenCV on Ubuntu](http://www.pyimagesearch.com/2016/10/24/ubuntu-16-04-how-to-install-opencv/) - How to instlal OpenCV on your machine.

[Cascade Classifier Training](http://docs.opencv.org/2.4/doc/user_guide/ug_traincascade.html#positive-samples) - Official document of cascade training by OpenCV 2.4

[Official Tutorial for Cascade Training](http://docs.opencv.org/3.2.0/dc/d88/tutorial_traincascade.html) - Official document of cascade training by OpenCV 3.0+

[Tutorial: OpenCV haartraining (Rapid Object Detection With A Cascade of Boosted Classifiers Based on Haar-like Features)](http://note.sonots.com/SciSoftware/haartraining.html) - Detailed cascade training process including optimal training configuration insights.

[Creating your own Haar Cascade OpenCV Python Tutorial](https://pythonprogramming.net/haar-cascade-object-detection-python-opencv-tutorial/) - Step by step guide to create first cascade training on Python.

[Train your own OpenCV Haar classifier](https://github.com/mrnugget/opencv-haar-classifier-training) - Another well written step by step guide to train cascade. Original source of the vecter merge code.

[Strategy to Make Cascade Training Fast](http://answers.opencv.org/question/7141/about-traincascade-paremeters-samples-and-other/) - Explains insights to configure the parameters better to get more accurate result of traininig.