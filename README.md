# object-recognizer

## Structure

  * data: data sources to build a model based upon
    * images: image data
      * negative: collections of background images in different size
      * positive: collections of positive images for different objects
  * model: includes trainer and constructed model
    * cascade: cascade classifier trainer and its model
      * cascade_generator: generate cascade
        * bin: buliding a training
        * positive_images: should contain processed positive images
        * tools: include a script to merge vector files
        * negative_images: should contain processed negative images
      * cascade_storage: store cascades generated by cascade_generater
      * cascade_testor: test stored cascades
  * util: generic scripts for other programs
    * bin: conduct all necessary precondition tasks for building training
    * libs: collection of program to conduct individual precondition tasks


## Cascade Classifier Training Process (Commands and Arguments)

1. Get negative sample images and put it in './negative_images' (NOT containing object that you want to recognize)
2. Get source positive sample images and put it in './positive_images' (containing object that you want to recognize)
3. To generate vec files from the samples, run 

      `$ python bin/build_train.py`

4. Conduct cascade training

      `$ opencv_traincascade -data classifier -vec object.vec -bg negatives.txt -numStages 15 -numPos 2000 -numNeg 1000 -w 30 -h 60 -mode ALL -precalcValBufSize 1024 -precalcIdxBufSize 1024`

## Cascade Training Benchmark 

- 16GB (8 CPU) on Digital Ocean
  - 20x20: gained nearly 10e-5 at stage 25 for about 10 hours running.
    - result of cascade quality: only sensitive to the 20x20 scale window.
    - to find cans standing up or lying down, need different cascades for eash.
  - 20x40: in progress
  - 40x20: to do

Since the code of cascade training itself is not optimzed for multi-core processing, it may not be possible to improve the computation time by adding more cores on the DigitalOcean server. Benchmark is for varyfing this assumption.

Be aware that to train, the size of positive image should be the same for the arguments -w and -h in the whole process of training. If you have multiple positive images, you should crop the image in the same ratio of width and height.

The cascade works well in the dark background for now. May be we should make the cascade background color configuration to be inverted so that the bright color foregorund cans turning to be dark on the bright background.

Building benchmarking tools is in progress of designing.


## Test Cascade

$ python testCascadeRealTime.py {cascade object width} {cascade object height} {scale factor} {minimum neighbors} {webcam frame width} {webcam frame height}

For example,
$ python testCascadeRealTime.py 20 50 1.1 22 800 600


## References:

[How to Install OpenCV on Ubuntu](http://www.pyimagesearch.com/2016/10/24/ubuntu-16-04-how-to-install-opencv/) - How to instlal OpenCV on your machine.

[Cascade Classifier Training](http://docs.opencv.org/2.4/doc/user_guide/ug_traincascade.html#positive-samples) - Official document of cascade training by OpenCV 2.4

[Official Tutorial for Cascade Training](http://docs.opencv.org/3.2.0/dc/d88/tutorial_traincascade.html) - Official document of cascade training by OpenCV 3.0+

[Tutorial: OpenCV haartraining (Rapid Object Detection With A Cascade of Boosted Classifiers Based on Haar-like Features)](http://note.sonots.com/SciSoftware/haartraining.html) - Detailed cascade training process including optimal training configuration insights.

[Creating your own Haar Cascade OpenCV Python Tutorial](https://pythonprogramming.net/haar-cascade-object-detection-python-opencv-tutorial/) - Step by step guide to create first cascade training on Python.

[Train your own OpenCV Haar classifier](https://github.com/mrnugget/opencv-haar-classifier-training) - Another well written step by step guide to train cascade. Original source of the vecter merge code.

[Strategy to Make Cascade Training Fast](http://answers.opencv.org/question/7141/about-traincascade-paremeters-samples-and-other/) - Explains insights to configure the parameters better to get more accurate result of traininig.